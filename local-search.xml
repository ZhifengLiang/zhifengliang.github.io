<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>QGIS二次开发环境搭建</title>
    <link href="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="1-安装OSGeo4W"><a href="#1-安装OSGeo4W" class="headerlink" title="1.安装OSGeo4W"></a>1.安装OSGeo4W</h1><p>下载Online (OSGeo4W) installer <a href="https://www.qgis.org/download/">QGIS网站</a></p><p><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E4%B8%8B%E8%BD%BDosgwo4w.png"></p><p>安装OSGeo4W<br><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E5%AE%89%E8%A3%85OSGeo4W.png"></p><p>安装qgis所需开发环境，搜索框中搜索<strong>qgis-ltr</strong>，安装所需开发环境<br><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E5%AE%89%E8%A3%85qgis-ltr.png"></p><h1 id="2-准备开发环境"><a href="#2-准备开发环境" class="headerlink" title="2.准备开发环境"></a>2.准备开发环境</h1><p>本文采用Visual Studio 2022 + CLion + CMake配置开发环境</p><h2 id="配置VS2022工具链"><a href="#配置VS2022工具链" class="headerlink" title="配置VS2022工具链"></a>配置VS2022工具链</h2><p>依次点击<strong>File-&gt;Settings</strong>，在<strong>Build, Execution, Deployment选项</strong>中，选择<strong>ToolChains</strong>，确保已经添加Visual Studio并设置为默认<br><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E9%85%8D%E7%BD%AEVS2022ToolChain.png"></p><h1 id="3-配置环境变量"><a href="#3-配置环境变量" class="headerlink" title="3.配置环境变量"></a>3.配置环境变量</h1><p>添加OSGEO4W_ROOT环境变量<br><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.png"></p><p>并将以下三个路径添加到Path中<br><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E5%A2%9E%E5%8A%A0path.png"></p><h1 id="4-CLion新建Qt程序"><a href="#4-CLion新建Qt程序" class="headerlink" title="4.CLion新建Qt程序"></a>4.CLion新建Qt程序</h1><h2 id="创建QtWidgets程序"><a href="#创建QtWidgets程序" class="headerlink" title="创建QtWidgets程序"></a>创建QtWidgets程序</h2><p>依次点击菜单File-&gt;New-&gt;Project创建一个新项目<br><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%96%B0%E5%BB%BAQt%E7%A8%8B%E5%BA%8F.png"></p><h2 id="配置CMakeList"><a href="#配置CMakeList" class="headerlink" title="配置CMakeList"></a>配置CMakeList</h2><p>添加以下配置到工程CMakeList.txt中</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># 指定OSGEO4W安装路径</span><br><span class="hljs-keyword">set</span>(OSGEO4W_ROOT <span class="hljs-string">&quot;D:/OSGeo4W&quot;</span>)<br><br><span class="hljs-comment"># 指定CMAKE_MODULE_PATH用于查找QGIS</span><br><span class="hljs-keyword">set</span>(CMAKE_MODULE_PATH <span class="hljs-variable">$&#123;OSGEO4W_ROOT&#125;</span>/apps/qgis-ltr)<br><br><span class="hljs-keyword">find_package</span>(QGIS COMPONENTS<br>        core<br>        gui<br>        REQUIRED)<br><br><span class="hljs-comment"># 避免M_PI引起的编译错误</span><br><span class="hljs-keyword">add_definitions</span>(-D_USE_MATH_DEFINES)<br><br><span class="hljs-comment"># 添加应用程序</span><br><span class="hljs-keyword">add_executable</span>(Demo main.cpp<br>)<br><br><span class="hljs-comment"># 添加头文件路径</span><br><span class="hljs-keyword">target_include_directories</span>(Demo PRIVATE<br>        <span class="hljs-variable">$&#123;QGIS_INCLUDE_DIR&#125;</span><br>)<br><br><span class="hljs-comment"># 链接QGIS模块</span><br><span class="hljs-keyword">target_link_libraries</span>(Demo<br>        Qt5::Core<br>        Qt5::Gui<br>        Qt5::Widgets<br>        Qt5::Xml<br>        <span class="hljs-variable">$&#123;QGIS_CORE_LIBRARY&#125;</span><br>        <span class="hljs-variable">$&#123;QGIS_GUI_LIBRARY&#125;</span><br>)<br></code></pre></td></tr></table></figure><h2 id="配置工程CMakeOptions"><a href="#配置工程CMakeOptions" class="headerlink" title="配置工程CMakeOptions"></a>配置工程CMakeOptions</h2><p>针对qgis-ltr版本，需要指定OSGEO4W_QGIS_SUBDIR宏定义。<br>一次点击<strong>File-&gt;Settings</strong>，在<strong>Build, Execution, Deployment选项</strong>中，选择<strong>CMake</strong>并添加**-DOSGEO4W_QGIS_SUBDIR&#x3D;”qgis-ltr”**到CMake Options中<br><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E9%85%8D%E7%BD%AECMakeOptions.png"></p><h1 id="5-实现一个简单的加载Shapefile功能"><a href="#5-实现一个简单的加载Shapefile功能" class="headerlink" title="5.实现一个简单的加载Shapefile功能"></a>5.实现一个简单的加载Shapefile功能</h1><h2 id="修改程序main-cpp"><a href="#修改程序main-cpp" class="headerlink" title="修改程序main.cpp"></a>修改程序main.cpp</h2><p>添加QGIS初始化相关代码到main函数中</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;qgsapplication.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>&#123;<br>    <span class="hljs-function">QgsApplication <span class="hljs-title">a</span><span class="hljs-params">(argc, argv, <span class="hljs-literal">true</span>)</span></span>;<br>    QgsApplication::<span class="hljs-built_in">setPrefixPath</span>(<span class="hljs-string">&quot;D:/OSGeo4W/apps/qgis-ltr&quot;</span>, <span class="hljs-literal">true</span>);<br><br>    QgsApplication::<span class="hljs-built_in">initQgis</span>();<br>    <br>    <span class="hljs-keyword">return</span> a.<span class="hljs-built_in">exec</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="增加一个mainwindow界面"><a href="#增加一个mainwindow界面" class="headerlink" title="增加一个mainwindow界面"></a>增加一个mainwindow界面</h2><p>右键工程，New-&gt;QT UI Class</p><p><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%B7%BB%E5%8A%A0mainwindow-ui.png"></p><p>并增加一个菜单用于相应打开文件，并把objectName修改为actionOpen</p><p><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%B7%BB%E5%8A%A0mainwindow%E8%8F%9C%E5%8D%95.png"></p><p>mainwindow.h中添加Qgs画布以及槽函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">private</span>:<br>    Ui::mainwindow *ui;<br>    <span class="hljs-comment">// QgsMapCanvash画布</span><br>    QgsMapCanvas* m_map_canvas;<br><br><span class="hljs-keyword">private</span> slots:<br>    <span class="hljs-comment">// 槽函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_actionOpen_triggered</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><p>mainwindow.cpp中增加一下代码</p><p>构造函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// 构造QgsMapCanvas对象并设置为CenttralWidget用于显示地图</span><br>mainwindow::<span class="hljs-built_in">mainwindow</span>(QWidget *parent)<br>    : <span class="hljs-built_in">QMainWindow</span>(parent)<br>    , <span class="hljs-built_in">ui</span>(<span class="hljs-keyword">new</span> Ui::mainwindow)<br>    , <span class="hljs-built_in">m_map_canvas</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">QgsMapCanvas</span>(<span class="hljs-keyword">this</span>))&#123;<br>    ui-&gt;<span class="hljs-built_in">setupUi</span>(<span class="hljs-keyword">this</span>);<br><br>    <span class="hljs-built_in">setCentralWidget</span>(m_map_canvas);<br>    m_map_canvas-&gt;<span class="hljs-built_in">setAttribute</span>(Qt::WA_MouseTracking);<br>    <span class="hljs-comment">// 设置地图漫游工具</span><br>    m_map_canvas-&gt;<span class="hljs-built_in">setMapTool</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">QgsMapToolPan</span>(m_map_canvas));<br>&#125;<br><br></code></pre></td></tr></table></figure><p>槽函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mainwindow::on_actionOpen_triggered</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">// 步骤一：浏览到本地shapefile文件</span><br>    QString fileName = QFileDialog::<span class="hljs-built_in">getOpenFileName</span>();<br>    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-built_in">isEmpty</span>())<br>        <span class="hljs-keyword">return</span>;<br>    <span class="hljs-function">QFileInfo <span class="hljs-title">fi</span><span class="hljs-params">(fileName)</span></span>;<br>    QString basename=fi.<span class="hljs-built_in">baseName</span>();<span class="hljs-comment">//获取文件基名称</span><br>    <span class="hljs-comment">// 步骤2：创建QgsVectorLayer类</span><br>    QgsVectorLayer* vecLayer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QgsVectorLayer</span>(fileName,basename,<span class="hljs-string">&quot;ogr&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!vecLayer-&gt;<span class="hljs-built_in">isValid</span>()) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">// 向画布添加图层</span><br>    m_map_canvas-&gt;<span class="hljs-built_in">setLayers</span>(<span class="hljs-built_in">QList</span>&lt;QgsMapLayer*&gt;()&lt;&lt;vecLayer);<br><br>    <span class="hljs-comment">// 设置该图层的单一渲染风格</span><br>    QgsSymbol* symbol = QgsSymbol::<span class="hljs-built_in">defaultSymbol</span>(vecLayer-&gt;<span class="hljs-built_in">geometryType</span>());<br>    symbol-&gt;<span class="hljs-built_in">setColor</span>(<span class="hljs-built_in">QColor</span>(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>,<span class="hljs-number">156</span>,<span class="hljs-number">255</span>));<br>    vecLayer-&gt;<span class="hljs-built_in">setRenderer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">QgsSingleSymbolRenderer</span>(symbol));<br><span class="hljs-comment">// 缩放地图到全图范围</span><br>    m_map_canvas-&gt;<span class="hljs-built_in">zoomToFullExtent</span>();<br>    m_map_canvas-&gt;<span class="hljs-built_in">refresh</span>();<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h1><p><img src="/2025/06/02/QGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%95%88%E6%9E%9C.gif"></p>]]></content>
    
    
    
    <tags>
      
      <tag>QGIS</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
